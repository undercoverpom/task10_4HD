<!-- views/index.ejs -->
<%- include('header') %>

    <!-- Carousel Section -->
    <div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="5000">
        <!-- Carousel Indicators -->
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active" aria-current="true"
                aria-label="Slide 1"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>

        <!-- Carousel Items -->
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="adrian-siaril-Lf8c4IBEMaQ-1-unsplash.jpg" class="d-block w-100" alt="Sun Hat">
                <div class="carousel-caption">
                    <h5>Vintage Sun Hats</h5>
                    <p>Classic designs for sunny days</p>
                </div>
            </div>
            <div class="carousel-item">
                <img src="brennan-burling-gZ9K9IlkvJA-1-unsplash.jpg" class="d-block w-100" alt="Baseball Cap">
                <div class="carousel-caption">
                    <h5>Premium Baseball Caps</h5>
                    <p>Quality craftsmanship in every stitch</p>
                </div>
            </div>
            <div class="carousel-item">
                <img src="devin-justesen-USczKmWK7P0-1-unsplash.jpg" class="d-block w-100" alt="Winter Hat">
                <div class="carousel-caption">
                    <h5>Winter Collection</h5>
                    <p>Stay warm in style</p>
                </div>
            </div>
        </div>

        <!-- Carousel Controls -->
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>

    <main>
        <div class="container-fluid bg-primary-subtle">
            <div class="col-sm-8 mx-auto text-center py-2">
                <h1 class="display-4">dKin Caps</h1>
                <p class="lead">A young and inspiring organisation whose primary purpose is to bring you the highest
                    quality headwear available.</p>
            </div>
        </div>

        <div class="container">
            <h3 class="mt-3">AI-Powered Cap Style Assistant</h3>
            <p>Find your perfect cap style with our intelligent recommendation system.</p>

            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-primary-subtle">
                            <h3>Upload Your Photo</h3>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="photo" class="form-label">Choose a photo to analyse</label>
                                <input type="file" class="form-control" id="photo" name="photo" accept="image/*">
                                <div class="form-text">Upload a clear front-facing photo for best results.</div>
                            </div>
                            <div id="processingStatus"></div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-primary-subtle">
                            <h3>Describe Your Style</h3>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="stylePreference" class="form-label">Tell us about your cap
                                    preferences</label>
                                <textarea class="form-control" id="stylePreference" name="stylePreference" rows="3"
                                    placeholder="Example: I prefer sporty baseball caps and like wearing them casually..."></textarea>
                                <div class="form-text">Include details about activities, style preferences, or specific
                                    needs.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Centered Get Recommendations Button -->
            <div class="row mb-5">
                <div class="col-12 text-center">
                    <form action="/process-text" method="post">
                        <input type="hidden" name="stylePreference" id="hiddenStylePreference">
                        <button type="submit" class="btn btn-primary btn-lg">Get Cap Recommendations</button>
                    </form>
                </div>
            </div>

            <!-- Implementation Details Sections -->
            <div class="row">
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5>
                                <button class="btn btn-link collapsed" data-bs-toggle="collapse"
                                    data-bs-target="#photoImplementation">
                                    💡 Implementation Details: Visual Analysis
                                </button>
                            </h5>
                        </div>
                        <div id="photoImplementation" class="collapse">
                            <div class="card-body">
                                <h6>Core Technologies:</h6>
                                <ul>
                                    <li>TensorFlow.js for client-side machine learning</li>
                                    <li>Blazeface model for facial detection and feature extraction</li>
                                    <li>HTML5 Canvas for image processing</li>
                                </ul>

                                <h6>Feature Detection Process:</h6>
                                <ol>
                                    <li>Photo Upload:
                                        <ul>
                                            <li>Client-side image validation</li>
                                            <li>FileReader API for image loading</li>
                                            <li>Canvas-based preprocessing</li>
                                        </ul>
                                    </li>
                                    <li>Face Analysis:
                                        <ul>
                                            <li>TensorFlow tensor conversion</li>
                                            <li>Blazeface landmark detection</li>
                                            <li>Ratio-based shape classification</li>
                                        </ul>
                                    </li>
                                    <li>Measurements:
                                        <ul>
                                            <li>Face width/height ratio</li>
                                            <li>Eye distance calculation</li>
                                            <li>Jaw width measurement</li>
                                        </ul>
                                    </li>
                                </ol>

                                <div class="alert alert-info">
                                    <strong>Developer Note:</strong> The visual analysis runs entirely client-side,
                                    ensuring user privacy by keeping photos on their device.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5>
                                <button class="btn btn-link collapsed" data-bs-toggle="collapse"
                                    data-bs-target="#textImplementation">
                                    💡 Implementation Details: Text Analysis
                                </button>
                            </h5>
                        </div>
                        <div id="textImplementation" class="collapse">
                            <div class="card-body">
                                <h6>Natural Language Processing:</h6>
                                <ul>
                                    <li>Keyword extraction and categorisation</li>
                                    <li>Context-aware preference matching</li>
                                    <li>Style category classification</li>
                                </ul>

                                <h6>Processing Pipeline:</h6>
                                <ol>
                                    <li>Text Preprocessing:
                                        <ul>
                                            <li>Input sanitisation</li>
                                            <li>Case normalisation</li>
                                            <li>Keyword tokenisation</li>
                                        </ul>
                                    </li>
                                    <li>Style Analysis:
                                        <ul>
                                            <li>Category matching (athletic, casual, etc.)</li>
                                            <li>Feature preference extraction</li>
                                            <li>Activity context detection</li>
                                        </ul>
                                    </li>
                                    <li>Recommendation Generation:
                                        <ul>
                                            <li>Style-based filtering</li>
                                            <li>Feature matching</li>
                                            <li>Priority scoring</li>
                                        </ul>
                                    </li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Architecture Documentation -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5>
                        <button class="btn btn-link collapsed" data-bs-toggle="collapse"
                            data-bs-target="#systemArchitecture">
                            🔧 System Architecture & Technical Guide
                        </button>
                    </h5>
                </div>
                <div id="systemArchitecture" class="collapse">
                    <div class="card-body">
                        <h5>Core Components:</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header">
                                        <h6 class="mb-0">Frontend Components</h6>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-unstyled">
                                            <li>📱 <strong>Views (EJS Templates)</strong>
                                                <ul>
                                                    <li>Responsive Bootstrap 5 layouts</li>
                                                    <li>Dynamic content rendering</li>
                                                    <li>Client-side validation</li>
                                                </ul>
                                            </li>
                                            <li>🔄 <strong>Client-Side Processing</strong>
                                                <ul>
                                                    <li>TensorFlow.js integration</li>
                                                    <li>Face detection pipeline</li>
                                                    <li>Real-time processing feedback</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header">
                                        <h6 class="mb-0">Backend Services</h6>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-unstyled">
                                            <li>⚙️ <strong>Express Server</strong>
                                                <ul>
                                                    <li>Route handling</li>
                                                    <li>Request validation</li>
                                                    <li>Error management</li>
                                                </ul>
                                            </li>
                                            <li>🧮 <strong>Analysis Engine</strong>
                                                <ul>
                                                    <li>Text processing pipeline</li>
                                                    <li>Recommendation algorithms</li>
                                                    <li>Face analysis integration</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h5>Implementation Guide:</h5>
                        <div class="alert alert-light">
                            <ol>
                                <li><strong>Environment Setup:</strong>
                                    <ul>
                                        <li>Node.js and npm installation</li>
                                        <li>Required dependencies</li>
                                        <li>Environment variables</li>
                                    </ul>
                                </li>
                                <li><strong>Core Dependencies:</strong>
                                    <ul>
                                        <li>Express.js for routing</li>
                                        <li>EJS for templating</li>
                                        <li>TensorFlow.js for ML</li>
                                        <li>Bootstrap for UI</li>
                                    </ul>
                                </li>
                                <li><strong>Project Structure:</strong>
                                    <ul>
                                        <li>/views - EJS templates</li>
                                        <li>/public_html - Static assets</li>
                                        <li>/js - Client-side scripts</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <p class="mt-5">
                Page generated on
                <% const now=new Date(); %>
                    <%= now.toLocaleString(); %>
            </p>
        </div>
    </main>

    <!-- JavaScript to sync textarea with hidden input -->
    <script>
        document.getElementById('stylePreference').addEventListener('input', function () {
            document.getElementById('hiddenStylePreference').value = this.value;
        });
    </script>
    <%- include('footer') %></document_content>